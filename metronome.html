<!--
a metronome app that can be used to practice playing an instrument.
with a simple interface include play/stop button, and a slider for bpm (the bpm should be adjustable), default at 60.
the metronome should be able to play in the background, and the page should be able to be closed.
-->
<!DOCTYPE html>
<html>

<head>
    <title>Metronome</title>
</head>
<style>
    body {
        background-color: #f2f2f2;
    }

    h1 {
        text-align: center;
    }

    p {
        text-align: center;
    }

    button {
        background-color: #4CAF50;
        /* Green */
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
    }

    .slider {
        -webkit-appearance: none;
        width: 100%;
        height: 25px;
        background: #d3d3d3;
        outline: none;
        opacity: 0.7;
        -webkit-transition: .2s;
        transition: opacity .2s;
    }

    .slider:hover {
        opacity: 1;
    }

    .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 25px;
        height: 25px;
        background: #4CAF50;
        cursor: pointer;
    }

    .slider::-moz-range-thumb {
        width: 25px;
        height: 25px;
        background: #4CAF50;
        cursor: pointer;
    }
</style>

<body>
    <h1>Metronome</h1>
    <p>Click the button to start the metronome.</p>
    <button onclick="startMetronome()">Start</button>
    <button onclick="stopMetronome()">Stop</button>
    <!-- slider for bpm that changes t-->
    <p>Adjust the bpm.</p>
    <input type="range" min="40" max="200" value="60" class="slider" id="bpm" oninput="adjustBpm()">
    <p id="demo"></p>
    <script>
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    // unlock audio context
    //let ctx = null;

    // create silent sound
    let bufferSize = 2 * ctx.sampleRate, 
        emptyBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate), 
        output = emptyBuffer.getChannelData(0);

    // fill buffer
    for(let i = 0; i < bufferSize; i++) 
        output[i] = 0;

    // create source node
    let source = ctx.createBufferSource();
    source.buffer = emptyBuffer;
    source.loop = true;

    // create destination node
    let node = ctx.createMediaStreamDestination();
    source.connect(node);

    // dummy audio element
    let audio = document.createElement("audio");
    audio.style.display = "none";
    document.body.appendChild(audio);

    // set source and play
    audio.srcObject = node.stream;
    audio.play();
    
    let click = new Audio("click1.wav");
    let bpm = 60;
    let interval = 0;
    let isPlaying = false;
    let timer = 0;
    let clickCount = 0;
    let clickCountDisplay = document.getElementById("demo");
    //play click sound when start button is clicked
    function startMetronome() {
            click.play();
            isPlaying = true;
            timer = setInterval(playClick, (60 / bpm) * 1000);
        }
        //stop click sound when stop button is clicked
    function stopMetronome() {
        click.pause();
        click.currentTime = 0;
        isPlaying = false;
        clearInterval(timer);
    }
    //play click sound
    function playClick() {
        if (isPlaying) {
            click.play();
            clickCount++;
            clickCountDisplay.innerHTML = clickCount;
        }
    }
    //adjust bpm
    function adjustBpm() {
        bpm = document.getElementById("bpm").value;
        if (isPlaying) {
            clearInterval(timer);
            timer = setInterval(playClick, (60 / bpm) * 1000);
        }
    }
    
        


    
    </script>
    
</body>

</html>